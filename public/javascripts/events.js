
function Attendee(){this.id=0;this.updated_at=new Date(0);this.notes=this.name=null;this.attended=false;this.norsvp=true;this.uiline=this.aform=this.event=this.event_id=null;this.parseJSON=function b(a){this.id=a.id;this.updated_at=new Date(a.updated_at);this.name=a.name;this.notes=a.notes;this.attended=a.attended;this.event_id=a.event_id;this.norsvp=a.norsvp};this.updateAttended=function b(){var a="";if(this.attended){this.event.attending-=1;a="Not Attending"}else{this.event.attending+=1;a="Attending"}if(confirm(this.name+
" is now "+a+" ?")){this.attended=!this.attended;this.uiLine();this.update(null);$("#attending_attendees").html(this.event.attending)}};this.updateDelete=function b(){confirm("Delete Attendee: "+this.name)&&this.destroy()};this.uiLine=function b(a){if(a)this.uiline=null;if(this.uiline==null){this.uiline=$("#attendee_line").clone();this.uiline.removeClass("hidden");this.uiline.attr("id",this.id);this.uiline.find("#attended").click(jQuery.proxy(this.updateAttended,this));this.uiline.find("#delete").click(jQuery.proxy(this.updateDelete,
this))}this.uiline.find("#name").html(this.name);this.attended?this.uiline.find("#attended").html("Not Attending"):this.uiline.find("#attended").html("Attending");return this.uiline};this.updateFromForm=function b(){this.name=this.aform.find("#name").val();this.notes=this.aform.find("#notes").val();this.norsvp=!this.aform.find("#norsvp").attr("checked");this.update(redrawAttendees)};this.updateForm=function b(a){a.find("#name").val(this.name);a.find("#notes").val(this.notes);a.find("#norsvp").attr("checked",
!this.norsvp)};this.updateFinished=function b(a,c,d,e){outstanding-=1;a.id==0&&a.parseJSON(c.attendee);if(a.aform!=null){if(a.aform.attr("id")=="attendee_form_0"){$("#add_button").removeClass("hidden");aevent.attendees.push(a)}a.aform.remove();a.aform=null}};this.update=function b(a){outstanding+=1;a=new Callback(a,this.updateFinished,this);var c,d;if(this.id==0){c="/events/"+this.event_id+"/attendees.json";d="POST"}else{c="/events/"+this.event_id+"/attendees/"+this.id+".json";d="PUT"}$.ajax({data:{authenticity_token:AUTH_TOKEN,
"attendee[name]":this.name,"attendee[notes]":this.notes,"attendee[attended]":this.attended,"attendee[norsvp]":this.norsvp},dataType:"json",type:d,success:jQuery.proxy(a.retrieveSuccess,a),error:jQuery.proxy(a.retrieveError,a),url:c})};this.retrieveFinished=function b(a,c,d,e){outstanding-=1};this.retrieve=function b(a){outstanding+=1;a=new Callback(a,this.retrieveFinished,this);$.ajax({data:{authenticity_token:AUTH_TOKEN},type:"GET",dataType:"json",success:jQuery.proxy(a.retrieveSuccess,a),error:jQuery.proxy(a.retrieveError,
a),url:"/events/"+this.event_id+"/attendees/"+this.id+".json"})};this.destroyFinished=function b(a,c,d,e){outstanding-=1;a.uiline!=null&&a.uiline.remove();aevent.removeAttendee(a)};this.destroy=function b(a){outstanding+=1;a=new Callback(a,this.destroyFinished,this);$.ajax({data:{authenticity_token:AUTH_TOKEN},type:"DELETE",dataType:"json",success:jQuery.proxy(a.retrieveSuccess,a),error:jQuery.proxy(a.retrieveError,a),url:"/events/"+this.event_id+"/attendees/"+this.id+".json"})}};
var aevent=new Event;
function Event(){this.id=0;this.updated_at=new Date(0);this.name=null;this.attending=0;this.attendees=[];this.parseJSON=function(a){this.id=a.id;this.updated_at=new Date(a.updated_at);this.name=a.name;this.attending=0;this.attendees=[];for(var b=0;b<a.attendees.length;b++){var c=new Attendee;c.parseJSON(a.attendees[b]);c.event=this;if(c.attended)this.attending+=1;this.attendees.push(c)}};this.updateFinished=function(a,b){outstanding-=1;b.event!=null&&a.parseJSON(b.event)};this.removeAttendee=function(a){for(var b=
0;b<this.attendees.length;b++)if(this.attendees[b].id==a.id){this.attendees.splice(b,1);return}};this.update=function(a){outstanding+=1;a=new Callback(a,this.updateFinished,this);var b,c;if(this.id==0){b="/events.json";c="POST"}else{b="/events/"+this.id+".json";c="PUT"}$.ajax({data:{authenticity_token:AUTH_TOKEN,"event[name]":this.name},dataType:"json",type:c,success:jQuery.proxy(a.retrieveSuccess,a),error:jQuery.proxy(a.retrieveError,a),url:b})};this.retrieveFinished=function(a,b){outstanding-=1;
a.parseJSON(b.event);$("#event_name").html(a.name);redrawAttendees()};this.retrieve=function(a){a=new Callback(a,this.retrieveFinished,this);outstanding+=1;$.ajax({data:{authenticity_token:AUTH_TOKEN},type:"GET",dataType:"json",success:jQuery.proxy(a.retrieveSuccess,a),error:jQuery.proxy(a.retrieveError,a),url:"/events/"+this.id+".json"})};this.destroyFinished=function(){outstanding-=1};this.destroy=function(a){outstanding+=1;a=new Callback(a,this.destroyFinished,this);$.ajax({data:{authenticity_token:AUTH_TOKEN},
type:"DELETE",dataType:"json",success:jQuery.proxy(a.retrieveSuccess,a),error:jQuery.proxy(a.retrieveError,a),url:"/events/"+this.id+".json"})}};
function displaybusy(){outstanding>0?$("#loading").removeClass("hidden"):$("#loading").addClass("hidden")}function redrawAttendees(){$("#total_attendees").html(aevent.attendees.length);$("#attending_attendees").html(aevent.attending);list=$("#event_attendees");list.find(".attendee").remove();for(var a=0;a<aevent.attendees.length;a++)list.append(aevent.attendees[a].uiLine(true))}function setCalcValue(a){$("#calc_money").val(a);updateCalc()}
function addCalcValue(a){var b=parseFloat($("#calc_money").val());$("#calc_money").val(b+a);updateCalc()}function updateCalc(){var a=parseFloat($("#calc_money").val()),b=parseFloat($("#calc_ticketnum").val()),d=parseFloat($("#calc_ticketprice").val()),c=0;c=a-b*d;$("#calc_change").html(c)}
function spawnAdd(){$("#add_button").addClass("hidden");box=$("#event_attendees");var a=new Attendee;newadd=$("#attendeeadd").clone();a.aform=newadd;a.event_id=event_id;newadd.removeClass("hidden");newadd.attr("id","attendee_form_0");newadd.find("#submit").click(jQuery.proxy(a.updateFromForm,a));a.updateForm(newadd);box.prepend(newadd)}$(document).ready(function(){aevent.id=event_id;setInterval("displaybusy()",100);aevent.retrieve(null)});
